<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header.html :: head"/>

<body>
<div th:replace="fragments/header.html :: header"/>
    <div class="container px-5">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-6 py-5">
                <form class="form-group" th:object="${board}" id="board">
                    <div>
                        <div class="img-box">
                            <img src="/assets/images/default.jpeg" alt="프로필 이미지" class="medium-img">
                        </div>
                        <h5 th:text="'작성자 : ' + ${board.userName}"></h5>
                        <h6>
                            <img src="/assets/images/eyes.svg" class="little-img"> 200
                            <img src="/assets/images/fill-hearts.svg" class="little-img" style="margin-left: 5px"> 10
                        </h6>
                    </div>
                    <br/>
                    <div>
                        <h1>[[${board.title}]]</h1>
                    </div>
                    <div>
                        <textarea rows="10" class="w-100" readonly>[[${board.content}]]
                        </textarea>
                    </div>
                    <div style="float: left" class="py-3">
                        <span th:text="'작성일 : ' + ${#temporals.format(board.createdAt, 'yyyy/MM/dd HH:mm:ss')}"></span>
                    </div>
                    <div align="right" class="py-1">
                        <th:block th:if="principal">
                            <a class="btn btn1" th:href="@{/boards/{boardId}/modify (boardId=${boardId})}">수정</a>
                            <button class="btn btn1" onclick="delete_board()">삭제</button>
                        </th:block>
                    </div>
                    <br/>
                </form>
                <div>
                    <button class="btn icon-btn">
                        <img src="/assets/images/empty-hearts.svg" class="little-img">
                    </button>
                    <button class="btn icon-btn">
                        <img src="/assets/images/fill-hearts.svg" class="little-img">
                    </button>
                </div>
                <hr/>

                <!-- 여기서부터 댓글 시작입니다!! -->
                <!-- 댓글 작성  th:method="post" th:action="@{/api/comment/4/create}" -->
                <form class="form-group" th:object="${commentCreateRequest}" id="commentCreateRequest">
                    <div>
                        <textarea th:field="*{content}" rows="3" class="w-100" placeholder="댓글을 입력해주세요"></textarea>
                        <input th:field="*{commentType}" value="BOARD_COMMENT" hidden>
                    </div>
                    <br/>
                    <div align="right">
                        <button type="submit" class="btn btn1" onclick="createComment()">댓글 등록</button>
                    </div>
                </form >
                <hr/>
                <!-- 댓글 조회 -->
                <div class="container" th:object="${commentPage}" >
                    <div class="card border-warning mb-3">
                        <!-- 댓글 머리(최상단) -->
                        <div class="card-header bi bi-chat-dots">
                            <span th:text="${commentSize}"></span>
                            <span> Comments</span>
                        </div>
                        <span style="line-height:90%"><br></span>
                        <!--본 댓글 조회-->
                        <ul class="list-group-flush"  th:each="comment: ${commentPage}">
                            <li class="list-group-item">
                                <span>
                                    <span span style="font-size: 15px;font-weight: bold;" th:text="${comment.nickname}"></span>
                                    <span style="font-size: xx-small;margin-left: 8px;" th:text="${comment.createdAt}"></span>
                                    <span style="float: right; margin-right: 15px">
                                    <a type="button" style="font-size: xx-small" data-bs-toggle="collapse" th:attr="data-bs-target='#createCoComment'+${comment.id}">답글</a>
                                    <a type="button" style="font-size: xx-small" data-bs-toggle="collapse" th:attr="data-bs-target='#updateComment'+${comment.id}">수정</a>
                                    <a type="button" style="font-size: xx-small">삭제</a>
                                    </span>
                                </span>
                                    <div th:text="${comment.content}" style="margin-top: 3px"></div>
                            </li>
                            <!-- 답글 버튼 누르면 나오는 대댓글 작성 창 -->
                            <div class="collapse" th:id="'createCoComment' + ${comment.id}">
                                <span style="line-height:20%"><br></span>
                                <form>
                                    <div class="input-group" style="width:auto; margin-right: 15px">
                                        <input type="text"  th:name="content" class="form-control">
                                        <input type="hidden" th:name="parentId"/>
                                        <button type="submit" class="btn btn-outline-warning">작성</button>
                                    </div>
                                </form>
                                <span style="line-height:20%"><br></span>
                            </div>
                            <!-- 수정 버튼 누르면 나오는 댓글 수정 창 -->
                            <div class="collapse" th:id="'updateComment' + ${comment.id}">
                                <span style="line-height:20%"><br></span>
                                <form>
                                    <div class="input-group" style="width:auto; margin-right: 15px">
                                        <input type="text"  th:name="content" class="form-control">
                                        <input type="hidden" th:name="parentId"/>
                                        <button type="submit" class="btn btn-outline-warning">수정</button>
                                    </div>
                                </form>
                                <span style="line-height:20%"><br></span>
                            </div>
                            <!-- 본 댓글 속 대댓글 조회-->
                            <ul class="list-group-flush"  th:each="coComment: ${comment.coComment}">
                                <li class="list-group-item">
                                <hr style="margin-bottom: 10px; margin-top: 5px; margin-right: 15px;">
                                <span>
                                    <span>↪ </span>
                                    <span span style="font-size: 15px;font-weight: bold;" th:text="${coComment.nickname}"></span>
                                    <span style="font-size: xx-small;margin-left: 8px" th:text="${coComment.createdAt}"></span>
                                    <span style="float: right; margin-right: 15px">
                                        <a type="button" style="font-size: xx-small" data-bs-toggle="collapse" th:attr="data-bs-target='#updateCoComment'+${coComment.id}">수정</a>
                                        <a type="button" style="font-size: xx-small">삭제</a>
                                    </span>
                                </span>
                                    <div th:text="${coComment.content}" style="margin-left: 17px; margin-top: 3px"></div>
                                </li>
                                <!-- 대댓글 수정 버튼 누르면 나오는 대댓글 수정 창 -->
                                <div class="collapse" th:id="'updateCoComment' + ${coComment.id}">
                                    <span style="line-height:20%"><br></span>
                                    <form>
                                        <div class="input-group" style="width:auto; margin-right: 15px">
                                            <input type="text"  th:name="content" class="form-control">
                                            <input type="hidden" th:name="parentId"/>
                                            <button type="submit" class="btn btn-outline-warning">수정</button>
                                        </div>
                                    </form>
                                    <span style="line-height:20%"><br></span>
                                </div>
                            </ul>
                            <hr style="margin-bottom: 0px; margin-top: 5px">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script th:inline="javascript">
    function createComment() {
        let postId = [[${boardId}]]
        $.ajax({
            type: 'post',
            url: '/api/comment/4/create',
            data: $('#commentCreateRequest').serialize(),
            success: function (message) {
                alert(message)
                location.href="/boards/"+5
            }
        })
    }

    function delete_board(){

        let boardId = [[${boardId}]];

        if (confirm("글을 삭제하시겠습니까?")){
            $.ajax({
                url : '/boards/'+boardId+'/delete/',
                type : "GET",
                data : {
                    boardId : boardId
                },
                success : function (){
                    location.href="/boards/new/write"
                }
            });
        }
    }

</script>

>>>>>>> src/main/resources/templates/boards/detail.html
</body>
</html>